From ddbbf4abed1e1fba7b757080a8fe8df375627903 Mon Sep 17 00:00:00 2001
From: skongkonga <3139771198@qq.com>
Date: Fri, 18 Oct 2024 12:06:00 +0800
Subject: [PATCH] feat: add PlayerReceiveMessageEvent


diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index d59d86efc..ab5d28f74 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -63,6 +63,7 @@ import org.bukkit.craftbukkit.util.CraftMagicNumbers;
 import org.bukkit.entity.EntityType;
 import org.bukkit.entity.Player;
 import org.bukkit.event.player.PlayerGameModeChangeEvent;
+import org.bukkit.event.player.PlayerReceiveMessageEvent;
 import org.bukkit.event.player.PlayerRegisterChannelEvent;
 import org.bukkit.event.player.PlayerTeleportEvent;
 import org.bukkit.event.player.PlayerUnregisterChannelEvent;
@@ -173,8 +174,13 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
 
     @Override
     public void sendMessage(String message) {
+        PlayerReceiveMessageEvent playerReceiveMessageEvent = new PlayerReceiveMessageEvent(this, message);
+        server.getPluginManager().callEvent(playerReceiveMessageEvent);
+        if (playerReceiveMessageEvent.isCancelled())
+            return;
+
         if (!conversationTracker.isConversingModaly()) {
-            this.sendRawMessage(message);
+            this.sendRawMessage(playerReceiveMessageEvent.getMessage());
         }
     }
 
-- 
2.42.0.windows.2

